!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/++plone++senaite.patient.static/bundles",n(n.s=1)}([function(e,t){e.exports=jQuery},function(e,t,n){e.exports=n(2)},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=[].indexOf,s=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.reset_temporary_identifiers=this.reset_temporary_identifiers.bind(this),this.set_patient_data=this.set_patient_data.bind(this),this.on_temporary_change=this.on_temporary_change.bind(this),this.on_mrn_deselected=this.on_mrn_deselected.bind(this),this.on_mrn_selected=this.on_mrn_selected.bind(this),this.on_patient_id_selected=this.on_patient_id_selected.bind(this),this.get_input_element=this.get_input_element.bind(this),this.get_field_name=this.get_field_name.bind(this),this.get_sibling=this.get_sibling.bind(this),this.set_sibling_value=this.set_sibling_value.bind(this),this.native_set_value=this.native_set_value.bind(this),this.format_date=this.format_date.bind(this),this.search_patient=this.search_patient.bind(this),this.ajax_submit=this.ajax_submit.bind(this),this.get_portal_url=this.get_portal_url.bind(this),this.debug=this.debug.bind(this),console.debug("TemporaryIdentifierWidget::load"),this.auto_wildcard="-- autogenerated --",this.is_add_sample_form=document.body.classList.contains("template-ar_add"),this.is_add_sample_form&&this.reset_temporary_identifiers(),i()("body").on("change",".TemporaryIdentifier input[type='checkbox']",this.on_temporary_change),i()("body").on("select",".TemporaryIdentifier",this.on_mrn_selected),i()("body").on("deselect",".TemporaryIdentifier",this.on_mrn_deselected),i()("body").on("select","tr[fieldname=PatientID] textarea",this.on_patient_id_selected),this}var t,n,r;return t=e,(n=[{key:"reset_temporary_identifiers",value:function(){var e=this;return this.debug("TemporaryIdentifierWidget::reset_temporary_identifiers"),document.querySelectorAll(".TemporaryIdentifier").forEach((function(t,n){var r,i,a;if((a=t.querySelector("input[name*='_temporary']")).checked)return a.checked=!1,r=t.querySelector("input[name*='_value_auto']"),e.native_set_value(r,""),i=t.querySelector("textarea"),e.native_set_value(i,""),e.set_sibling_value(t,"PatientID","")}))}},{key:"set_patient_data",value:function(e,t){var n,r,i,a;for(n in r={MedicalRecordNumber:"","PatientFullName.firstname":"","PatientFullName.lastname":"",PatientAddress:"","DateOfBirth.dob":"",Age:"",Sex:"",Gender:"",PatientID:""},i=[],r=Object.assign(r,t))a=r[n],i.push(this.set_sibling_value(e,n,a));return i}},{key:"on_temporary_change",value:function(e){var t,n,r,i;return this.debug("°°° TemporaryIdentifierWidget::on_temporary_change °°°"),t=e.currentTarget,n=this.get_field_name(t),i=t.checked,r=this.get_input_element(n),i&&!r.value?this.native_set_value(r,this.auto_wildcard):i||r.value!==this.auto_wildcard?void 0:this.native_set_value(r,"")}},{key:"on_mrn_deselected",value:function(e){var t,n;return this.debug("°°° TemporaryIdentifierWidget::on_mrn_deselected °°°"),t=e.currentTarget,n=this.get_field_name(t),document.getElementById("".concat(n,"_temporary")).checked=!1,this.set_patient_data(t,{})}},{key:"on_mrn_selected",value:function(e){var t,n,r=this;if(this.debug("°°° TemporaryIdentifierWidget::on_mrn_selected °°°"),e.currentTarget,(n=e.detail.value)!==this.auto_wildcard)return t=e.currentTarget,this.search_patient({patient_mrn:n}).done((function(e){var n,i,a;if(e)return n=[(i=e.address[0]).address,i.zip,i.city,i.country].filter((function(e){return e})).join(", "),e.address_line=n,a={MedicalRecordNumber:e.mrn,"PatientFullName.firstname":e.firstname,"PatientFullName.lastname":e.lastname,PatientAddress:n,"DateOfBirth.dob":r.format_date(e.birthdate),Age:e.age,Sex:e.sex,Gender:e.gender,PatientID:e.patient_id,review_state:e.review_state},r.set_patient_data(t,a)}))}},{key:"on_patient_id_selected",value:function(e){var t,n,r=this;return this.debug("°°° TemporaryIdentifierWidget::on_patient_id_selected °°°"),e.currentTarget,n=e.detail.value,t=e.currentTarget,this.search_patient({patient_id:n}).done((function(e){var n,i,a;if(e)return n=[(i=e.address[0]).address,i.zip,i.city,i.country].filter((function(e){return e})).join(", "),e.address_line=n,a={MedicalRecordNumber:e.mrn,"PatientFullName.firstname":e.firstname,"PatientFullName.lastname":e.lastname,PatientAddress:n,"DateOfBirth.dob":r.format_date(e.birthdate),Age:e.age,Sex:e.sex,Gender:e.gender,PatientID:e.patient_id,review_state:e.review_state},r.set_patient_data(t,a)}))}},{key:"get_input_element",value:function(e){return document.querySelector("#".concat(e," textarea"))}},{key:"get_field_name",value:function(e){var t;return t=e.closest("div[data-fieldname]"),i()(t).attr("data-fieldname")}},{key:"get_sibling",value:function(e,t){var n,r,a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return n=t,this.is_add_sample_form&&(r=e.closest("td[arnum]"),n=t+"-"+i()(r).attr("arnum")),a='[name="'+n+'"]',""!==o&&(a='[name^="'+(n=n+"."+o)+':"]'),document.querySelector(a)}},{key:"set_sibling_value",value:function(e,t,n){var r,i,a;if(this.debug("°°° TemporaryIdentifierWidget::set_sibling_value:name=".concat(t,",value=").concat(n," °°°")),a="",o.call(t,".")>=0&&(i=t.split("."),t=i[0],a=i[1]),r=this.get_sibling(e,t,a))return this.debug(">>> ".concat(r.name," = ").concat(n," ")),this.native_set_value(r,n)}},{key:"native_set_value",value:function(e,t){var n,r;return r=null,"TEXTAREA"===e.tagName?r=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value").set:"SELECT"===e.tagName?r=Object.getOwnPropertyDescriptor(window.HTMLSelectElement.prototype,"value").set:"INPUT"===e.tagName?r=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set:e.value=t,r&&r.call(e,t),n=new Event("input",{bubbles:!0}),e.dispatchEvent(n)}},{key:"format_date",value:function(e){var t;return null==e?"":[(t=new Date(e)).getFullYear(),("0"+(t.getMonth()+1)).slice(-2),("0"+t.getDate()).slice(-2)].join("-")}},{key:"search_patient",value:function(e){var t,n,r;return this.debug("°°° TemporaryIdentifierWidget::search_patient °°°"),t={portal_type:"Patient",catalog_name:document.querySelector('[name="config_catalog"]').value,include_fields:["mrn","patient_id","firstname","lastname","age","birthdate","sex","gender","email","address","review_state"],page_size:1},t=Object.assign(t,e),n=i.a.Deferred(),r={url:this.get_portal_url()+"/@@API/read",data:t},this.ajax_submit(r).done((function(e){var t;return t={},e.objects&&(t=e.objects[0]),n.resolveWith(this,[t])})),n.promise()}},{key:"ajax_submit",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.debug("°°° TemporaryIdentifierWidget::ajax_submit °°°"),null==t.type&&(t.type="POST"),null==t.url&&(t.url=this.get_portal_url()),null==t.context&&(t.context=this),null==t.dataType&&(t.dataType="json"),null==t.data&&(t.data={}),null==t._authenticator&&(t._authenticator=i()("input[name='_authenticator']").val()),console.debug(">>> ajax_submit::options=",t),i()(this).trigger("ajax:submit:start"),e=function(){return i()(this).trigger("ajax:submit:end")},i.a.ajax(t).done(e)}},{key:"get_portal_url",value:function(){return i()("input[name=portal_url]").val()||window.portal_url}},{key:"debug",value:function(e){return console.debug("[senaite.patient.temporary_identifier_widget] ",e)}}])&&a(t.prototype,n),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(){var t,n,r,a;for(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bind_event_handler=this.bind_event_handler.bind(this),this.on_age_selector_change=this.on_age_selector_change.bind(this),this.on_fallback_dob_change=this.on_fallback_dob_change.bind(this),console.debug("AgeDoBWidgetController::load"),this.bind_event_handler(),".AgeDoBWidget input[type='radio'][checked]",n=0,r=(a=document.querySelectorAll(".AgeDoBWidget input[type='radio'][checked]")).length;n<r;n++)t=a[n],i()(t).trigger("change");return this}var t,n,r;return t=e,(n=[{key:"bind_event_handler",value:function(){var e;return console.debug("AgeDoBWidgetController::bind_event_handler"),e=".AgeDoBWidget input[type='radio']",i()("body").on("change",e,this.on_age_selector_change),e=".AgeDoBWidget input[id$='-dob-fallback']",i()("body").on("change",e,this.on_fallback_dob_change)}},{key:"on_age_selector_change",value:function(e){var t,n,r,a,o,s,d,l;return console.debug("AgeDoBWidgetController::on_age_selector_change"),d=(a=e.currentTarget).closest(".AgeDoBWidget"),s=null!=(o="1"===i()(d).attr("data-required"))?o:{required:""},t=d.querySelector('[id$="_age_controls"]'),n=d.querySelector('[id$="_dob_controls"]'),l=d.querySelector('[id$=".years:ignore_empty:record"]'),r=d.querySelector('[id$=".dob:ignore_empty:record"]'),"age"===i()(a).val()?(i()(t).show(),i()(n).hide(),l.setAttribute("required",s),r.removeAttribute("required")):(i()(t).hide(),i()(n).show(),l.removeAttribute("required"),r.setAttribute("required",s))}},{key:"on_fallback_dob_change",value:function(e){var t,n,r;return console.debug("AgeDoBWidgetController::on_fallback_dob_change"),(t=(r=(n=e.currentTarget).closest(".AgeDoBWidget")).querySelector("input[id$='_dob_selector']")).setAttribute("checked",""),i()(t).trigger("change"),r.querySelector('[id$=".dob:ignore_empty:record"]').value=n.value}}])&&d(t.prototype,n),r&&d(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();document.addEventListener("DOMContentLoaded",(function(){console.debug("*** SENAITE PATIENT JS LOADED ***"),window.temporary_identifier_widget=new s,window.age_dob_widget=new l}))}]);